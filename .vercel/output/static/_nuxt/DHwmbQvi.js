import{j as g,r as c,k as E,f as p,K as l}from"./71iuM9A_.js";const w=()=>{const{$supabase:o}=g(),t=c(null),u=c(!1),s=c(null),d=async e=>{try{u.value=!0,s.value=null;const{data:r,error:a}=await o.auth.signInWithPassword({email:e.email,password:e.password});return a?(s.value=n(a),{success:!1,error:s.value}):r.user?(t.value=r.user,{success:!0,user:r.user}):{success:!1,error:"Login falhou"}}catch(r){const a=r instanceof Error?r.message:"Erro desconhecido";return s.value=a,{success:!1,error:a}}finally{u.value=!1}},f=async e=>{try{if(u.value=!0,s.value=null,e.password!==e.confirmPassword)return s.value="As senhas não coincidem",{success:!1,error:s.value};if(e.password.length<6)return s.value="A senha deve ter pelo menos 6 caracteres",{success:!1,error:s.value};const{data:r,error:a}=await o.auth.signUp({email:e.email,password:e.password});if(a)return s.value=n(a),{success:!1,error:s.value};if(r.user){if(r.user&&!r.session)return{success:!0,user:r.user,message:"Conta criada! Verifique seu email para confirmar a conta."};if(r.user&&r.session)return t.value=r.user,{success:!0,user:r.user,message:"Conta criada com sucesso!"}}return{success:!1,error:"Erro ao criar conta"}}catch(r){const a=r instanceof Error?r.message:"Erro desconhecido";return s.value=a,{success:!1,error:a}}finally{u.value=!1}},v=async()=>{try{u.value=!0,s.value=null;const{error:e}=await o.auth.signOut();return e?(s.value=n(e),{success:!1,error:s.value}):(t.value=null,{success:!0})}catch(e){const r=e instanceof Error?e.message:"Erro desconhecido";return s.value=r,{success:!1,error:r}}finally{u.value=!1}},i=async()=>{try{u.value=!0;const{data:{session:e}}=await o.auth.getSession();e?.user&&(t.value=e.user)}catch(e){console.error("Erro ao verificar autenticação:",e)}finally{u.value=!1}},n=e=>{switch(e.message){case"Invalid login credentials":return"Email ou senha incorretos";case"Email not confirmed":return"Email ainda não confirmado";case"Too many requests":return"Muitas tentativas. Tente novamente mais tarde";case"User already registered":return"Este email já está cadastrado";case"Password should be at least 6 characters":return"A senha deve ter pelo menos 6 caracteres";case"Invalid email":return"Email inválido";case"Signup is disabled":return"Cadastro de novos usuários está desabilitado";default:return e.message||"Erro na autenticação"}},m=async()=>{try{const{data:{session:e}}=await o.auth.getSession();return!!e?.user}catch(e){return console.error("Erro ao verificar autenticação:",e),!1}},h=E(()=>!!t.value);return p(()=>{i(),o.auth.onAuthStateChange((e,r)=>{r?.user?t.value=r.user:t.value=null})}),{user:l(t),loading:l(u),error:l(s),isAuthenticated:h,login:d,register:f,logout:v,checkAuth:i,isUserAuthenticated:m}};export{w as u};
